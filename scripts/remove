#!/bin/bash

#=================================================
# GENERIC START
#=================================================
# IMPORT GENERIC HELPERS
#=================================================

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# LOAD SETTINGS
#=================================================

app=$YNH_APP_INSTANCE_NAME

domain=$(ynh_app_setting_get $app domain)

#=================================================
# STANDARD REMOVE
#=================================================
# REMOVE SERVICE FROM ADMIN PANEL
#=================================================

# Remove a service from the admin panel, added by `yunohost service add`
if yunohost service status | grep -q $app
then
	echo "Remove $app service"
	yunohost service remove $app
fi

#=================================================
# REMOVE DEPENDENCIES
#=================================================

rm -f /etc/biboumi/biboumi.cfg

# Remove metapackage and its dependencies
ynh_remove_app_dependencies
rm -rf /var/lib/biboumi
rm -rf /var/log/biboumi

#=================================================
# REMOVE LOGROTATE CONFIGURATION
#=================================================

# Remove the app-specific logrotate config
#ynh_remove_logrotate
# TODO ynh_remove_logrotate


## XXX these 2 variables are also defined in install. Dear maintainer, please merge these somewhere else. In _common?
MARKER_START="-- START Patch from biboumi_ynh"
MARKER_END="-- END Patch from biboumi_ynh"

sed -i "/${MARKER_START}/,/${MARKER_END}/d" /etc/metronome/metronome.cfg.lua

# Remove stretch-backports config file if exists
rm -f /etc/apt/sources.list.d/${app}_needs_stretch-backports.list
